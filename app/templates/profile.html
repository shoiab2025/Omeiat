{% extends 'base_layout.html' %}
{% load static %}
{% block content %}

<div class="container my-5">
    <h2>User Profile</h2>
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="row">

            <!-- Basic Info -->
            <div class="col-12 col-md-6 mb-3">
                <label class="form-label">Username</label>
                <input type="text" name="username" class="form-control" value="{{ user.username }}">
            </div>
            <div class="col-12 col-md-6 mb-3">
                <label class="form-label">Email</label>
                <input type="email" name="email" class="form-control" value="{{ user.email }}">
            </div>
            <div class="col-12 col-md-6 mb-3">
                <label class="form-label">Phone</label>
                <input type="text" name="phone" class="form-control" value="{{ user.phone }}">
            </div>
            <div class="col-12 col-md-6 mb-3">
                <label class="form-label">Date of Birth</label>
                <input type="date" name="dob" class="form-control" value="{{ user.dob|date:'Y-m-d' }}">
            </div>

            <div class="col-12 col-md-6 mb-3">
                <label class="form-label">Father's Name</label>
                <input type="text" name="father_name" class="form-control" value="{{ user.father_name }}">
            </div>
            <div class="col-12 col-md-6 mb-3">
                <label class="form-label">Spouse Name</label>
                <input type="text" name="spouse_name" class="form-control" value="{{ user.spouse_name }}">
            </div>
            <div class="col-12 mb-3">
                <label class="form-label">Profile Picture</label>
                <input type="file" name="profile_picture" class="form-control">
                {% if user.profile_picture %}
                    <img src="{{ user.profile_picture.url }}" alt="Profile" style="height:80px;" class="mt-2">
                {% endif %}
            </div>

            <!-- Address -->
            <h5 class="mt-4">Address</h5>
            {% with addr=user.address %}
            <div class="col-12 col-md-6 mb-3">
                <label class="form-label">Building No</label>
                <input type="text" name="building_no" class="form-control" value="{{ addr.building_no }}">
            </div>
            <div class="col-12 col-md-6 mb-3">
                <label class="form-label">Street</label>
                <input type="text" name="street" class="form-control" value="{{ addr.street }}">
            </div>
            <div class="col-12 col-md-6 mb-3">
                <label class="form-label">Area</label>
                <input type="text" name="area" class="form-control" value="{{ addr.area }}">
            </div>
            <div class="col-12 col-md-6 mb-3">
                <label class="form-label">District</label>
                <input type="text" name="district" class="form-control" value="{{ addr.district }}">
            </div>
            <div class="col-12 col-md-6 mb-3">
                <label class="form-label">State</label>
                <input type="text" name="state" class="form-control" value="{{ addr.state }}">
            </div>
            <div class="col-12 col-md-6 mb-3">
                <label class="form-label">Pincode</label>
                <input type="text" name="pincode" class="form-control" value="{{ addr.pincode }}">
            </div>
            {% endwith %}

            <!-- Education -->
            <h5 class="mt-4">Education</h5>
            <div id="education-container">
                {% for edu in user.educations.all %}
                <div class="education-entry row mb-3">
                    <div class="col-md-3">
                        <label class="form-label">Level</label>
                        <select name="edu_level[]" class="form-select w-100">
                            {% for lvl, lbl in edu.LEVEL_CHOICES %}
                                <option value="{{ lvl }}" {% if edu.level == lvl %}selected{% endif %}>{{ lbl }}</option>
                            {% endfor %}
                        </select>

                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Institution</label>
                        <input type="text" name="edu_institution[]" class="form-control w-100" value="{{ edu.institution }}">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Degree</label>
                        <input type="text" name="edu_degree[]" class="form-control w-100" value="{{ edu.degree }}">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Percentage</label>
                        <input type="number" step="0.01" name="edu_percentage[]" class="form-control w-100" value="{{ edu.percentage }}">
                    </div>
                </div>
                {% endfor %}
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mb-3" onclick="addEducation()">Add Education</button>

            <!-- Work Experience -->
            <h5 class="mt-4">Work Experience</h5>
            <div id="experience-container">
                {% for exp in user.experiences.all %}
                <div class="experience-entry row mb-3">
                    <div class="col-md-3">
                        <label class="form-label">Company</label>
                        <input type="text" name="exp_company[]" class="form-control w-100" value="{{ exp.company }}">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Role</label>
                        <input type="text" name="exp_role[]" class="form-control w-100" value="{{ exp.role }}">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Start Date</label>
                        <input type="date" name="exp_start_date[]" class="form-control w-100" value="{{ exp.start_date }}">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">End Date</label>
                        <input type="date" name="exp_end_date[]" class="form-control w-100" value="{{ exp.end_date }}">
                    </div>
                    <div class="col-md-12 mt-2">
                        <label class="form-label">Description</label>
                        <textarea name="exp_description[]" class="form-control w-100">{{ exp.description }}</textarea>
                    </div>
                </div>
                {% endfor %}
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mb-3" onclick="addExperience()">Add Experience</button>

            <!-- Skills -->
            <h5 class="mt-4">Skills</h5>
            <div id="skill-container">
                {% for skill in user.skills.all %}
                <div class="row mb-3 skill-entry">
                    <div class="col-md-6">
                        <label class="form-label">Skill</label>
                        <input type="text" name="skill_name[]" class="form-control w-100" value="{{ skill.name }}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Level</label>
                        <select name="skill_level[]" class="form-control">
                            {% for lvl, lbl in skill.LEVEL_CHOICES %}
                                <option value="{{ lvl }}" {% if skill.level == lvl %}selected{% endif %}>{{ lbl }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                {% endfor %}
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mb-3" onclick="addSkill()">Add Skill</button>

            <!-- Languages -->
            <h5 class="mt-4">Languages</h5>
            <div id="language-container">
                {% for lang in user.languages.all %}
                <div class="row mb-3 language-entry">
                    <div class="col-md-6">
                        <label class="form-label">Language</label>
                        <input type="text" name="lang_name[]" class="form-control w-100" value="{{ lang.name }}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Proficiency</label>
                        <select name="lang_proficiency[]" class="form-control">
                            {% for lvl, lbl in lang.PROFICIENCY_CHOICES %}
                                <option value="{{ lvl }}" {% if lang.proficiency == lvl %}selected{% endif %}>{{ lbl }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                {% endfor %}
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mb-3" onclick="addLanguage()">Add Language</button>

            <!-- Submit -->
            <div class="col-12 mt-4">
                <button type="submit" class="btn btn-primary">Save Profile</button>
            </div>

        </div>
    </form>
</div>

<!-- Hidden templates for cloning -->
<div id="education-template" class="d-none">
    <div class="education-entry row mb-3">
        <div class="col-md-3">
            <label class="form-label">Level</label>
            <select name="edu_level[]" class="form-control">
                <option value="SSLC">SSLC</option>
                <option value="HSS">HSS</option>
                <option value="Diploma">Diploma</option>
                <option value="Bachelor">Bachelor</option>
                <option value="Master">Master</option>
                <option value="PhD">PhD</option>
                <option value="Other">Other</option>
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Institution</label>
            <input type="text" name="edu_institution[]" class="form-control">
        </div>
        <div class="col-md-3">
            <label class="form-label">Degree</label>
            <input type="text" name="edu_degree[]" class="form-control">
        </div>
        <div class="col-md-3">
            <label class="form-label">Percentage</label>
            <input type="number" step="0.01" name="edu_percentage[]" class="form-control">
        </div>
    </div>
</div>

<div id="experience-template" class="d-none">
    <div class="experience-entry row mb-3">
        <div class="col-md-3">
            <label class="form-label">Company</label>
            <input type="text" name="exp_company[]" class="form-control">
        </div>
        <div class="col-md-3">
            <label class="form-label">Role</label>
            <input type="text" name="exp_role[]" class="form-control">
        </div>
        <div class="col-md-3">
            <label class="form-label">Start Date</label>
            <input type="date" name="exp_start_date[]" class="form-control">
        </div>
        <div class="col-md-3">
            <label class="form-label">End Date</label>
            <input type="date" name="exp_end_date[]" class="form-control">
        </div>
        <div class="col-md-12 mt-2">
            <label class="form-label">Description</label>
            <textarea name="exp_description[]" class="form-control"></textarea>
        </div>
    </div>
</div>

<div id="skill-template" class="d-none">
    <div class="row mb-3 skill-entry">
        <div class="col-md-6">
            <label class="form-label">Skill</label>
            <input type="text" name="skill_name[]" class="form-control">
        </div>
        <div class="col-md-6">
            <label class="form-label">Level</label>
            <select name="skill_level[]" class="form-control">
                <option value="Beginner">Beginner</option>
                <option value="Intermediate">Intermediate</option>
                <option value="Expert">Expert</option>
            </select>
        </div>
    </div>
</div>

<div id="language-template" class="d-none">
    <div class="row mb-3 language-entry">
        <div class="col-md-6">
            <label class="form-label">Language</label>
            <input type="text" name="lang_name[]" class="form-control">
        </div>
        <div class="col-md-6">
            <label class="form-label">Proficiency</label>
            <select name="lang_proficiency[]" class="form-control">
                <option value="Basic">Basic</option>
                <option value="Fluent">Fluent</option>
                <option value="Native">Native</option>
            </select>
        </div>
    </div>
</div>

<script>
function addEducation() {
    const container = document.getElementById('education-container');
    const template = document.getElementById('education-template').firstElementChild.cloneNode(true);
    container.appendChild(template);
}
function addExperience() {
    const container = document.getElementById('experience-container');
    const template = document.getElementById('experience-template').firstElementChild.cloneNode(true);
    container.appendChild(template);
}
function addSkill() {
    const container = document.getElementById('skill-container');
    const template = document.getElementById('skill-template').firstElementChild.cloneNode(true);
    container.appendChild(template);
}
function addLanguage() {
    const container = document.getElementById('language-container');
    const template = document.getElementById('language-template').firstElementChild.cloneNode(true);
    container.appendChild(template);
}
</script>

{% endblock content %}
